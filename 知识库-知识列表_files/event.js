define(function(){var COMOS_COMMON_API={};function bindEvent(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function offEvent(e,t,n){e.addEventListener?e.removeEventListener(t,n,!1):e.attachEvent&&e.detachEvent("on"+t,n)}function Selector(e){"object"==typeof e&&(this.el=[e])}function $(e){return new Selector(e)}function preventDefault(e){e._keyCode=e.keyCode,e.keyCode=0,e.preventDefault?e.preventDefault():e.returnValue=!1}function arrayHas(e,t){if(e.indexOf)return-1!==e.indexOf(t);for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return!0;return!1}Selector.prototype.on=function(e,t){for(var n=0,o=this.el.length;n<o;n++)r=n,bindEvent(this.el[r],e,t);var r},Selector.prototype.off=function(e,t){for(var n=0,o=this.el.length;n<o;n++)r=n,offEvent(this.el[r],e,t);var r};var ua=window.navigator.userAgent,__tmpVersion=ua.match(/MSIE (\d)/),IEBrowserVersion=__tmpVersion&&2===__tmpVersion.length?__tmpVersion[1]:50,inputlTag=["input","textarea"];function specialKeyEvent(e){var t=(e=e||window.event).target||e.srcElement,n=t.nodeName.toLowerCase(),o=t.readOnly,r=e.altKey,i=e.keyCode,a=!1,c=t.isContentEditable;if((116===i||r&&37===i||r&&39===i)&&(a=!0),8===i&&("input"===n&&o||!arrayHas(inputlTag,n))&&(c||(a=!0)),a)return preventDefault(e),!1}function keyEvent(e){var t=((e=e||window.event).target||e.srcElement).nodeName.toLowerCase();arrayHas(inputlTag,t)||COMOS_COMMON_API.sendMessage({type:"keyEvent",data:{keyCode:e.keyCode||e._keyCode,isAlt:e.altKey,isCtrl:e.ctrlKey}})}var tools={checkType:function(e){try{return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1]}catch(t){return""}}},lowBrowser={obj2String:function(e){if("undefined"!=typeof JSON)return JSON.stringify(e);var t="",n=tools.checkType(e);if("Object"===n){for(var o in t="{",e)o&&("Number"===(n=tools.checkType(e[o]))||"Boolean"===n?t+='"'+o+'":'+e[o]+",":"String"===n?t+='"'+o+'": "'+e[o]+'",':"Object"!==n&&"Array"!==n||(t+='"'+o+'": '+lowBrowser.obj2String(e[o])));t=","===t.charAt(t.length-1)?t.substring(0,t.length-1)+"}":t+"}"}else{if("Array"!==n)return e;t="[";o=0;for(var r=e.length;o<r;o++)"Number"===(n=tools.checkType(e[o]))||"Boolean"===n?t+=e[o]:"String"===n?t+='"'+onj[o]+'"':"Object"!==n&&"Array"!==n||(t+=lowBrowser.obj2String(e[o]))}return t},string2Obj:function(string){return"undefined"!=typeof JSON?JSON.parse(string):(window.__coms__tmp__data=null,eval("__coms__tmp__data="+string),window.__coms__tmp__data)}};return COMOS_COMMON_API.denySpecialKey=function(){$(document).on("keydown",specialKeyEvent)},COMOS_COMMON_API.closeCommonUE=function(){$(document).off("keydown",specialKeyEvent)},COMOS_COMMON_API.__keyEvent=function(){$(document).on("keydown",keyEvent)},COMOS_COMMON_API.sendMessage=function(e){window.postMessage&&(IEBrowserVersion<=8?window.top.postMessage(lowBrowser.obj2String(e),"*"):window.top.postMessage(e,"*"))},COMOS_COMMON_API.onMessage=function(){$(window).on("message",function(e){var t=e.data;IEBrowserVersion<=8&&(t=lowBrowser.string2Obj(e.data)),window.top==window&&COMOS_COMMON_API.eventCenter.fire(t.type,t,e.source)})},COMOS_COMMON_API.eventCenter={__cache:{},on:function(e,t){this.__cache[e]||(this.__cache[e]=[]),this.__cache[e].push(t)},fire:function(e,t,n){for(var o=this.__cache[e]||[],r=0,i=o.length;r<i;r++)if("function"==typeof o[r])try{o[r](t,n)}catch(a){console.error(a)}},off:function(e,t){if(t){for(var n=this.__cache[e]||[],o=-1,r=0,i=n.length;r<i;r++)n[r]===t&&(o=r);-1!==o&&n.splice(r,1)}else this.__cache[e]=[]}},COMOS_COMMON_API.init=function(){COMOS_COMMON_API.__initOnce||(COMOS_COMMON_API.__initOnce=!0,this.onMessage(),this.denySpecialKey(),this.__keyEvent())},COMOS_COMMON_API.ajaxCallback=function(e,t){"BUSIOPER=RELOGIN"==e.returnCode?console.log("连接超时-----BUSIOPER=RELOGIN"):"404"==e.returnCode&&console.log("错误------404")},COMOS_COMMON_API.ajaxAbnormalStart=!1,COMOS_COMMON_API.init(),COMOS_COMMON_API});